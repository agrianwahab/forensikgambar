```html
{% extends 'base.html' %}

{% block content %}
<!--
ASCII Mockup for Results Page:
+------------------------------------------------------+
| [Logo] Forensic Image Detection System               |
| Home | Upload | History | About | (User)            |
+------------------------------------------------------+
|                                                      |
|                   HASIL ANALISIS GAMBAR              |
|                   File: [ sample_image_01.jpg ]      |
|                                                      |
|   +----------------------------------------------+   |
|   | HASIL UTAMA: COPY-MOVE FORGERY TERDETEKSI    |   |
|   | Confidence: 78.3% (Tinggi)                   |   |
|   +----------------------------------------------+   |
|                                                      |
|   [ Original ] [ ELA ] [ Features ] [ Heatmap ]      |
|   +----------------------------------------------+   |
|   |                                              |   |
|   |         [ Visualisasi Gambar Terpilih ]      |   |
|   |                                              |   |
|   +----------------------------------------------+   |
|                                                      |
|   Detail Teknis:                                     |
|   - ELA Mean: 12.4, Std: 18.7                      |
|   - RANSAC Inliers: 45                             |
|   - ...                                              |
|                                                      |
|   [ Export PNG ] [ Export PDF ] [ Export DOCX ]      |
|                                                      |
+------------------------------------------------------+
| Â© 2025 Sistem Deteksi Forensik Gambar                |
+------------------------------------------------------+
-->
<div class="results-page terminal-container">
    <div class="results-header terminal-header">
        <h2 class="terminal-title">Hasil Analisis: {{ analysis.original_filename }}</h2>
        <div class="action-buttons">
            <a href="{{ url_for('main.upload') }}" class="btn btn-secondary btn-sm">[Analisis Gambar Lain]</a>
             <a href="{{ url_for('main.history') }}" class="btn btn-info btn-sm">[Kembali ke Riwayat]</a>
        </div>
    </div>

    <div class="results-content">
        {% if analysis.status == 'error' %}
            <div class="alert alert-danger">
                <h4>Analisis Gagal</h4>
                <p>Terjadi kesalahan saat menganalisis gambar ini.</p>
                {% if technical_data and technical_data.error %}
                    <p><strong>Detail Kesalahan:</strong> {{ technical_data.error }}</p>
                {% endif %}
            </div>
        {% else %}
            <div class="result-summary card">
                <h3 class="summary-title">Kesimpulan Analisis: 
                    <span class="status-{{ analysis.result_type|lower|replace(' ', '-') }}">{{ analysis.result_type }}</span>
                </h3>
                <p class="confidence-score">
                    Skor Kepercayaan: <strong>{{ "%.1f"|format(analysis.confidence) }}%</strong>
                    {% set confidence_level = "" %}
                    {% if analysis.confidence >= 85 %}
                        {% set confidence_level = "Sangat Tinggi" %}
                        {% set confidence_class = "high" %}
                    {% elif analysis.confidence >= 70 %}
                        {% set confidence_level = "Tinggi" %}
                        {% set confidence_class = "medium-high" %}
                    {% elif analysis.confidence >= 50 %}
                        {% set confidence_level = "Sedang" %}
                        {% set confidence_class = "medium" %}
                    {% else %}
                        {% set confidence_level = "Rendah" %}
                        {% set confidence_class = "low" %}
                    {% endif %}
                    (<span class="confidence-level-{{confidence_class}}">{{ confidence_level }}</span>)
                </p>
                {% if technical_data and technical_data.classification and technical_data.classification.details %}
                <div class="key-findings">
                    <strong>Indikator Kunci:</strong>
                    <ul>
                        {% for detail in technical_data.classification.details[:5] %} {# Tampilkan maks 5 #}
                            <li>{{ detail }}</li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}
            </div>

            <div class="visualization-section card">
                <h3 class="section-subtitle">Visualisasi Hasil Analisis</h3>
                {% if vis_png_filename %}
                    <img src="{{ url_for('main.serve_results_file', filename=vis_png_filename) }}" 
                         alt="Visualisasi Hasil Analisis untuk {{ analysis.original_filename }}" 
                         class="img-fluid result-visualization-image">
                {% else %}
                    <p class="text-muted">Visualisasi utama tidak tersedia. Anda dapat mencoba mengekspor.</p>
                {% endif %}
                <!-- Tambahkan tab di sini jika diperlukan untuk ELA, Heatmap, dll secara terpisah -->
            </div>
            
            <div class="technical-details-section card">
                <h3 class="section-subtitle">Detail Teknis Analisis</h3>
                {% if technical_data %}
                    <div class="technical-data-grid">
                        <div class="data-group">
                            <h4>Informasi Dasar</h4>
                            <p><strong>File Asli:</strong> {{ analysis.original_filename }}</p>
                            <p><strong>Dianalisis Pada:</strong> {{ analysis.created_at.strftime('%d %b %Y, %H:%M') }}</p>
                            <p><strong>Ukuran Asli:</strong> {{ technical_data.metadata.get('FileSize (bytes)', 'N/A')|int|filesizeformat if technical_data.metadata and technical_data.metadata.get('FileSize (bytes)') else 'N/A' }}</p>
                            <p><strong>Dimensi Asli:</strong> {{ technical_data.metadata.get('Image ImageWidth', 'N/A') }} x {{ technical_data.metadata.get('Image ImageLength', 'N/A') }}</p>
                        </div>
                        
                        {% if technical_data.ela_mean is defined %}
                        <div class="data-group">
                            <h4>Analisis ELA</h4>
                            <p><strong>ELA Mean:</strong> {{ "%.2f"|format(technical_data.ela_mean) }}</p>
                            <p><strong>ELA Std Dev:</strong> {{ "%.2f"|format(technical_data.ela_std) }}</p>
                            {% if technical_data.ela_regional_stats %}
                            <p><strong>Outlier Regions (ELA):</strong> {{ technical_data.ela_regional_stats.outlier_regions }}</p>
                            <p><strong>ELA Inconsistency:</strong> {{ "%.3f"|format(technical_data.ela_regional_stats.regional_inconsistency) }}</p>
                            {% endif %}
                        </div>
                        {% endif %}

                        {% if technical_data.sift_matches is defined %}
                        <div class="data-group">
                            <h4>Deteksi Copy-Move (Fitur)</h4>
                            <p><strong>SIFT Matches:</strong> {{ technical_data.sift_matches }}</p>
                            <p><strong>RANSAC Inliers:</strong> {{ technical_data.ransac_inliers }}</p>
                            <p><strong>Block Matches:</strong> {{ technical_data.block_matches|length }}</p>
                            {% if technical_data.geometric_transform %}
                            <p><strong>Transformasi Geometris:</strong> {{ technical_data.geometric_transform[0] }}</p>
                            {% endif %}
                        </div>
                        {% endif %}

                        {% if technical_data.noise_analysis %}
                        <div class="data-group">
                            <h4>Analisis Noise & JPEG</h4>
                            <p><strong>Noise Inconsistency:</strong> {{ "%.3f"|format(technical_data.noise_analysis.overall_inconsistency) }}</p>
                            {% if technical_data.jpeg_analysis %}
                            <p><strong>JPEG Ghost Suspicious Ratio:</strong> {{ "%.1f%%"|format(technical_data.jpeg_ghost_suspicious_ratio * 100) }}</p>
                            <p><strong>Est. Original JPEG Quality:</strong> {{ technical_data.jpeg_analysis.estimated_original_quality }}</p>
                            <p><strong>JPEG Compression Inconsistency:</strong> {{ technical_data.jpeg_analysis.compression_inconsistency }}</p>
                            {% endif %}
                        </div>
                        {% endif %}
                        
                        {% if technical_data.classification %}
                        <div class="data-group">
                            <h4>Skor Klasifikasi</h4>
                             <p><strong>Copy-Move Score:</strong> {{ technical_data.classification.copy_move_score }}/100</p>
                             <p><strong>Splicing Score:</strong> {{ technical_data.classification.splicing_score }}/100</p>
                        </div>
                        {% endif %}
                         {# Tambahkan grup data lain sesuai kebutuhan dari technical_data #}
                    </div>
                     <details class="raw-json-details">
                        <summary>Tampilkan Data Teknis Mentah (JSON)</summary>
                        <pre><code>{{ technical_data|tojson(indent=2) }}</code></pre>
                    </details>
                {% else %}
                    <p>Data teknis tidak tersedia.</p>
                {% endif %}
            </div>

            <div class="export-options-section card">
                <h3 class="section-subtitle">Opsi Ekspor</h3>
                <div class="export-buttons">
                    {% if analysis.export_png %}
                    <a href="{{ url_for('main.export_file_route', analysis_id=analysis.id, export_type='png') }}" class="btn btn-success">[Export PNG Visualisasi]</a>
                    {% endif %}
                    {% if analysis.export_pdf %}
                     <a href="{{ url_for('main.export_file_route', analysis_id=analysis.id, export_type='pdf') }}" class="btn btn-danger">[Export PDF Visualisasi]</a>
                    {% endif %}
                    {% if analysis.export_docx %}
                     <a href="{{ url_for('main.export_file_route', analysis_id=analysis.id, export_type='docx') }}" class="btn btn-info">[Export DOCX Laporan]</a>
                    {% endif %}
                    {% if not (analysis.export_png or analysis.export_pdf or analysis.export_docx) %}
                    <p class="text-muted">Tidak ada opsi ekspor yang dipilih saat unggah.</p>
                    {% endif %}
                </div>
            </div>
            
        {% endif %} {# End if not analysis error #}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/results.js') }}"></script>
{% endblock %}
```
